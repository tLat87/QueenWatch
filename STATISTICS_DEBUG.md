# Отладка статистики QueenWatch

## Проблема
Статистика не сохраняется в игре.

## Решение

### 1. Добавлена отладочная информация
- В `SoloGameScreen.tsx` добавлены console.log для отслеживания сохранения
- В `PartyGameScreen.tsx` добавлено сохранение результатов партийной игры
- В `StatisticsScreen.tsx` добавлены console.log для отслеживания загрузки
- Добавлены Alert для уведомления об ошибках

### 2. Автоматическое обновление статистики
- Добавлен `useFocusEffect` в `StatisticsScreen.tsx`
- Статистика теперь обновляется при возвращении на экран

### 3. Инструменты отладки
- **Test Save** - кнопка для тестового сохранения случайного результата
- **Debug Storage** - кнопка для вывода всей информации о AsyncStorage в консоль
- Утилита `storageDebug.ts` для диагностики

### 4. Как использовать отладку

1. **Запустите игру** и сыграйте несколько раундов
2. **Перейдите в статистику** - данные должны появиться
3. **Если данных нет**:
   - Нажмите "Test Save" для тестового сохранения
   - Нажмите "Debug Storage" и проверьте консоль
   - Проверьте консоль на наличие ошибок

### 5. Проверка консоли

Откройте консоль разработчика и найдите:
```
Saving result for date: 2024-01-15 time: 234
Result saved successfully: {"2024-01-15": [234, 456, 789]}
Loading results from AsyncStorage...
Solo data from storage: {"2024-01-15": [234, 456, 789]}
Parsed solo results: {"2024-01-15": [234, 456, 789]}
```

### 6. Возможные проблемы

1. **AsyncStorage не работает** - проверьте права доступа
2. **Данные не сохраняются** - проверьте ошибки в консоли
3. **Данные не загружаются** - проверьте формат JSON
4. **Статистика не обновляется** - проверьте useFocusEffect

### 7. Очистка данных

Если нужно очистить все данные:
```javascript
import { clearAllStorage } from './src/utils/storageDebug';
clearAllStorage();
```

### 8. Структура данных

```javascript
// soloResults
{
  "2024-01-15": [234, 456, 789],
  "2024-01-16": [123, 345, 567]
}

// partyResults
{
  "2024-01-15": [234, 456, 789],
  "2024-01-16": [123, 345, 567]
}
```

## Результат

После внесения изменений:
- ✅ Статистика сохраняется при каждой игре (Solo и Party)
- ✅ Статистика автоматически обновляется при переходе на экран
- ✅ Добавлена отладочная информация
- ✅ Добавлены инструменты для тестирования
- ✅ Улучшена обработка ошибок
- ✅ PartyGameScreen теперь сохраняет результаты всех игроков
